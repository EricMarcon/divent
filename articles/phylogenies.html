<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Phylogenies in divent • divent</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Phylogenies in divent">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">divent</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.5-3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/divent.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/arguments.html">Common Arguments of divent Functions</a></li>
    <li><a class="dropdown-item" href="../articles/extrapolation.html">Asymptotic Estimation, Interpolation and Extrapolation </a></li>
    <li><a class="dropdown-item" href="../articles/phylogenies.html">Phylogenies in divent</a></li>
    <li><a class="dropdown-item" href="../articles/simulations.html">Random communities</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/EricMarcon/divent/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Phylogenies in divent</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EricMarcon/divent/blob/master/vignettes/articles/phylogenies.Rmd" class="external-link"><code>vignettes/articles/phylogenies.Rmd</code></a></small>
      <div class="d-none name"><code>phylogenies.Rmd</code></div>
    </div>

    
    
<p><em>divent</em> is a package for <em>R</em> designed to estimate
diversity based on HCDT entropy or similarity-based entropy.</p>
<p>Several object classes can be used in the package to represent
phylogenies and calculate phylogenetic diversity. They are detailed
here.</p>
<div class="section level2">
<h2 id="formats-used">Formats used<a class="anchor" aria-label="anchor" href="#formats-used"></a>
</h2>
<p>Supported phylogenies are classes <code>phylo</code> from package
<em>ape</em>, <code>phylog</code> from package <em>ade4</em> and
<code>hclust</code> from package <em>base</em>.</p>
<p>To optimize performance, a specific class <code>phylo_divent</code>
is introduced by the package: it is basically a list containing a
<code>phylo</code> and an <code>hclust</code> representation of the
phylogeny and preprocessed useful statistics.</p>
<p>The argument <code>tree</code> used in phylogenetic diversity
estimation functions of the package may be any of those formats.
Conversion to <code>phylo_divent</code> is managed internally.</p>
</div>
<div class="section level2">
<h2 id="conversion-between-classes">Conversion between classes<a class="anchor" aria-label="anchor" href="#conversion-between-classes"></a>
</h2>
<p>Let’s start from an ultrametric distance matrix. Three species are
defined, with distance 1 between the first 2 and distance 2 between both
and the last one.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">species_dist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">species_dist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span></span>
<span><span class="va">species_dist</span></span></code></pre></div>
<pre><code><span><span class="co">##   A B C</span></span>
<span><span class="co">## A 0 1 2</span></span>
<span><span class="co">## B 1 0 2</span></span>
<span><span class="co">## C 2 2 0</span></span></code></pre>
<div class="section level3">
<h3 id="hclust">hclust<a class="anchor" aria-label="anchor" href="#hclust"></a>
</h3>
<p>An <code>hclust</code> object is created by UPGMA hierarchical
clustering.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"stats"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">tree.hclust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="va">species_dist</span><span class="op">)</span>, </span>
<span>    method <span class="op">=</span> <span class="st">"average"</span></span>
<span>  <span class="op">)</span>, </span>
<span>  hang <span class="op">=</span> <span class="op">-</span><span class="fl">0.01</span>, </span>
<span>  axes <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="phylogenies_files/figure-html/hclust-1.png" width="700"></p>
<p>Node heights are stored in <code>$height</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree.hclust</span><span class="op">$</span><span class="va">height</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 2</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="phylo">phylo<a class="anchor" aria-label="anchor" href="#phylo"></a>
</h3>
<p>Conversion to a <code>phylo</code> object is straightforward.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/emmanuelparadis/ape" class="external-link">"ape"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree.phylo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/as.phylo.html" class="external-link">as.phylo</a></span><span class="op">(</span><span class="va">tree.hclust</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="phylogenies_files/figure-html/phylo-1.png" width="700"></p>
<p>Edge lengths have been divided by 2 during the conversion, as
documented in <code><a href="https://rdrr.io/pkg/ape/man/as.phylo.html" class="external-link">?as.phylo.hclust</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree.phylo</span><span class="op">$</span><span class="va">edge.length</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.0 0.5 0.5 0.5</span></span></code></pre>
<p>That does not suit our needs. In <em>divent</em>, edge lengths are
multiplied by 2 after conversion, so that <code>phylo</code> objects can
be identical to other phylogenies.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree.phylo</span><span class="op">$</span><span class="va">edge.length</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">tree.phylo</span><span class="op">$</span><span class="va">edge.length</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree.phylo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="phylogenies_files/figure-html/phylo3-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="phylog">phylog<a class="anchor" aria-label="anchor" href="#phylog"></a>
</h3>
<p>The last conversion is from <code>phylo</code> to
<code>phylog</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://adeverse.github.io/ade4/" class="external-link">"ade4"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree.phylog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://adeverse.github.io/ade4/reference/newick2phylog.html" class="external-link">hclust2phylog</a></span><span class="op">(</span><span class="va">tree.hclust</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="phylogenies_files/figure-html/phylog-1.png" width="700"></p>
<p>Edge lengths are not stored directly in <code>phylog</code> objects.
The <code>$droot</code> component keeps distances from tips to root. The
<code>$Wdist</code> component is a <code>dist</code> (half a distance
matrix without the zero-diagonal) whose values are <span class="math inline">\(d_{s,t}=\sqrt{2 \delta_{s,t}^2}\)</span>, where
<span class="math inline">\(\delta_{s,t}\)</span> is the distance
between species <span class="math inline">\(s\)</span> ant <span class="math inline">\(t\)</span>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree.phylog</span><span class="op">$</span><span class="va">droot</span></span></code></pre></div>
<pre><code><span><span class="co">##    C    A    B Int1 Root </span></span>
<span><span class="co">##    2    2    2    1    0</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree.phylog</span><span class="op">$</span><span class="va">Wdist</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">2</span></span></code></pre></div>
<pre><code><span><span class="co">##   C A</span></span>
<span><span class="co">## A 2  </span></span>
<span><span class="co">## B 2 1</span></span></code></pre>
<p><code>phylog</code> trees are supported by <em>divent</em> but are
converted to <code>hclust</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree2.hclust</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">tree.phylog</span><span class="op">$</span><span class="va">Wdist</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fl">2</span>, <span class="st">"average"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree2.hclust</span>, hang <span class="op">=</span> <span class="op">-</span><span class="fl">0.01</span>, axes <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="phylogenies_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="phylo_divent">phylo_divent<a class="anchor" aria-label="anchor" href="#phylo_divent"></a>
</h3>
<p>The function <code>as_phylo_divent</code> converts any object of one
of the previous types.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ericmarcon.github.io/divent/">"divent"</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Rcpp</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree.phylo_divent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phylo_divent.html">as_phylo_divent</a></span><span class="op">(</span><span class="va">tree.phylo</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="phylogenies_files/figure-html/phylo_divent-1.png" width="700"></p>
<p>Its <code>plot</code> method is that of <code>dendrogram</code>
objects.</p>
<p>A <code>phylo_divent</code> tree is a list.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree.phylo_divent</span></span></code></pre></div>
<pre><code><span><span class="co">## $phylo</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Phylogenetic tree with 3 tips and 2 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tip labels:</span></span>
<span><span class="co">##   A, B, C</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Rooted; includes branch length(s).</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $hclust</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## ape::as.hclust.phylo(x = tree)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Cluster method   : unknown </span></span>
<span><span class="co">## Number of objects: 3 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $height</span></span>
<span><span class="co">## [1] 2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $cuts</span></span>
<span><span class="co">## [1] 1 2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $intervals</span></span>
<span><span class="co">## [1] 1 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $phylo_groups</span></span>
<span><span class="co">##   0 1</span></span>
<span><span class="co">## A 1 1</span></span>
<span><span class="co">## B 2 1</span></span>
<span><span class="co">## C 3 2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "phylo_divent"</span></span></code></pre>
<p>It contains:</p>
<ul>
<li>
<code>$phylo</code>: the tree as a <code>phylo</code> object.</li>
<li>
<code>$hclust</code>: the tree as a <code>hclust</code> object.</li>
<li>
<code>$height</code>: the height of the tree.</li>
<li>
<code>$cuts</code>: the heights of the nodes of the tree.</li>
<li>
<code>$intervals</code>: the intervals between the cuts.</li>
<li>
<code>$phylo_groups</code>: a matrix that describes the ancestors of
species in each interval. The column names give the most recent cut of
each interval. Values are the group each present species belongs to in
each interval. In the example above, species A and B belong to the same
group in the interval starting at 1.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="newick-dendrograms">Newick dendrograms<a class="anchor" aria-label="anchor" href="#newick-dendrograms"></a>
</h2>
<p>A Newick description of a dendrogram can be read into a
<code>phylo</code> object, that can be in turn converted to
<code>phylo_divent</code> or used directly in <em>divent</em>
functions.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NewickABC</span> <span class="op">&lt;-</span> <span class="st">"(C:2,(A:1,B:1):1);"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phyloABC</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span>text <span class="op">=</span> <span class="va">NewickABC</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="phylogenies_files/figure-html/Newick-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eric Marcon, Florence Puech.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
